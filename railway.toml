# =============================================================================
# RAILWAY CONFIGURATION - Sistema RAC PepsiCo
# =============================================================================
# Este arquivo configura o deploy automatizado no Railway
# Documentação: https://docs.railway.app/deploy/config-as-code
# =============================================================================

[build]
# Builder: Nixpacks (detecção automática de Node.js + TypeScript)
builder = "NIXPACKS"

# Build command para o backend
buildCommand = "cd backend && npm install && npx prisma generate && npm run build"

[deploy]
# Start command: executa migrations antes de iniciar o servidor
startCommand = "cd backend && npx prisma migrate deploy && npm start"

# Health check configuration
healthcheckPath = "/health"
healthcheckTimeout = 100

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Volumes para persistência de uploads (opcional - recomenda-se S3/R2 em produção)
# Descomente as linhas abaixo se quiser usar Railway Volumes:
# [[deploy.volumes]]
# mountPath = "/app/uploads"
# name = "uploads-storage"

# =============================================================================
# NOTAS IMPORTANTES
# =============================================================================
#
# 1. VARIÁVEIS DE AMBIENTE:
#    Configure manualmente no Railway Dashboard:
#    - GOOGLE_MAPS_API_KEY
#    - ANTHROPIC_API_KEY
#    - JWT_SECRET (gerar com: openssl rand -base64 32)
#    - FRONTEND_URL (URL do frontend Railway)
#    - NODE_ENV=production
#    - CLAUDE_VISION_MODEL=haiku
#    - PHOTOS_DIR=/app/uploads/fotos
#
#    Railway injeta automaticamente:
#    - DATABASE_URL (ao conectar PostgreSQL)
#    - REDIS_URL (ao conectar Redis)
#    - PORT (porta do servidor)
#
# 2. SERVIÇOS NECESSÁRIOS:
#    - PostgreSQL 16 (banco principal)
#    - Redis 7 (Bull queues)
#    - Node.js service (backend)
#    - Static site (frontend - deploy separado)
#
# 3. UPLOADS:
#    - Opção A: Railway Volumes (limitado a 1 instância)
#    - Opção B: Cloudflare R2 / AWS S3 (recomendado para produção)
#
# 4. CORS:
#    Atualizar backend/src/index.ts com URL do frontend após deploy
#
# =============================================================================
